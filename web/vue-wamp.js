/*!
 * vue-wamp v2.0.6
 * https://github.com/lajosbencz/vue-wamp#readme
 * Released under the MIT License.
 */(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b(require("autobahn")):"function"==typeof define&&define.amd?define(["autobahn"],b):(a=a||self,a.VueWamp=b(a.autobahn))})(this,function(a){"use strict";function b(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function c(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function d(a,b,d){return b&&c(a.prototype,b),d&&c(a,d),a}function e(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&g(a,b)}function f(a){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},f(a)}function g(a,b){return g=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},g(a,b)}function h(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function i(a,b){return b&&("object"==typeof b||"function"==typeof b)?b:h(a)}function j(a,b){for(;!Object.prototype.hasOwnProperty.call(a,b)&&(a=f(a),null!==a););return a}function k(a,b,c){return k="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(a,b,c){var d=j(a,b);if(d){var e=Object.getOwnPropertyDescriptor(d,b);return e.get?e.get.call(c):e.value}},k(a,b,c||a)}a=a&&a.hasOwnProperty("default")?a["default"]:a;var l=require("./_export");l(l.S+l.F,"Object",{assign:require("./_object-assign")});var m=require("./_object-dp").f,n=Function.prototype,o=/^\s*function ([^ (]*)/,p="name";p in n||require("./_descriptors")&&m(n,p,{configurable:!0,get:function(){try{return(""+this).match(o)[1]}catch(a){return""}}});var q=function(){function a(c){b(this,a),this._con=c,this._reconnectors=[],this._subscriptions=[],this._registrations=[]}return d(a,[{key:"subscribe",value:function(a,b,c){var d=this;c=c||{},c.acknowledge=!0,this._reconnectors.push(function(){d._con.subscribe(a,b,c).then(function(a){return d._subscriptions.push(a)}).catch(console.error)})}},{key:"register",value:function(a,b,c){var d=this;c=c||{},c.acknowledge=!0,this._reconnectors.push(function(){d._con.register(a,b,c).then(function(a){return d._registrations.push(a)}).catch(console.error)})}},{key:"unsubscribe",value:function(a){for(var b in this._subscriptions)if(this._subscriptions.hasOwnProperty(b)){var c=this._subscriptions[b];c===a&&(this._subscriptions=this._subscriptions.splice(b,1))}}},{key:"unregister",value:function(a){for(var b in this._registrations)if(this._registrations.hasOwnProperty(b)){var c=this._registrations[b];c===a&&(this._registrations=this._registrations.splice(b,1))}}},{key:"clear",value:function(){this._reconnectors=[]}},{key:"reconnected",value:function(){for(var a in this._reconnectors){var b=this._reconnectors[a];b()}}},{key:"closed",value:function(){for(;0<this._subscriptions.length;){var a=this._subscriptions.shift();this._con.unsubscribe(a).catch(function(){})}for(;0<this._registrations.length;){var b=this._registrations.shift();this._con.unregister(b).catch(function(){})}}}]),a}(),r=function(){function a(c,d,e){var f=this;b(this,a),this._con=c,this._ctx=d,this._persist=new q(c,e),e.$on("reconnected",function(){f._persist.reconnected()}),e.$on("closed",function(){f.closed(),f._persist.closed()}),this._subscriptions=[],this._registrations=[]}return d(a,[{key:"open",value:function(){return this._con.open()}},{key:"close",value:function(a,b){return this._con.close(a,b)}},{key:"call",value:function(a,b,c,d){return this._con.call(a,b,c,d)}},{key:"subscribe",value:function(a,b,c){var e=this;c=c||{},c.acknowledge=!0;var f=this._con.defer();return this._con.subscribe(a,b,c).then(function(a){e._subscriptions.push(a),f.resolve(a)},f.reject),this._persist.subscribe(a,b,c),f.promise}},{key:"register",value:function(a,b,c){var e=this;c=c||{},c.acknowledge=!0;var f=this._con.defer();return this._con.register(a,b,c).then(function(a){e._registrations.push(a),f.resolve(a)},f.reject),this._persist.register(a,b,c),f.promise}},{key:"publish",value:function(a,b,c,d){return this._con.publish(a,b,c,d)}},{key:"unsubscribe",value:function(a){for(var b in this._subscriptions)if(this._subscriptions.hasOwnProperty(b)){var c=this._subscriptions[b];c===a&&(this._subscriptions=this._subscriptions.splice(b,1))}return this._persist.unsubscribe(a),this._con.unsubscribe(a)}},{key:"unregister",value:function(a){for(var b in this._registrations)if(this._registrations.hasOwnProperty(b)){var c=this._registrations[b];c===a&&(this._registrations=this._registrations.splice(b,1))}return this._persist.unregister(a),this._con.unregister(a)}},{key:"closed",value:function(){for(;0<this._subscriptions.length;){var a=this._subscriptions.shift();this._con.unsubscribe(a).catch(function(){})}for(;0<this._registrations.length;){var b=this._registrations.shift();this._con.unregister(b).catch(function(){})}}},{key:"destroy",value:function(){this.closed(),this._persist.closed(),this._persist.clear()}},{key:"isConnected",get:function(){return this._con.isConnected}},{key:"isOpen",get:function(){return this._con.isOpen}},{key:"isRetrying",get:function(){return this._con.isRetrying}}]),a}(),s="[vue-wamp]",t={log:function(){},info:function(){},warn:function(){},error:function(){}},u={log:function(){for(var b,c=arguments.length,d=Array(c),a=0;a<c;a++)d[a]=arguments[a];(b=console).log.apply(b,[s].concat(d))},info:function(){for(var b,c=arguments.length,d=Array(c),a=0;a<c;a++)d[a]=arguments[a];(b=console).info.apply(b,[s].concat(d))},warn:function(){for(var b,c=arguments.length,d=Array(c),a=0;a<c;a++)d[a]=arguments[a];(b=console).warn.apply(b,[s].concat(d))},error:function(){for(var b,c=arguments.length,d=Array(c),a=0;a<c;a++)d[a]=arguments[a];(b=console).error.apply(b,[s].concat(d))}},v={debug:!1},w=function(a){function c(a,d){var g;b(this,c),a=Object.assign({},v,a),g=i(this,f(c).call(this,a)),g._vueWampEvents=d,g._vueWampCfg=a,g._vueWampQRes=[],g._vueWampQRej=[];var j={isConnected:!1,isOpen:!1,isRetrying:!1},k=function(a){var b={isConnected:g.isConnected,isOpen:g.isOpen,isRetrying:g.isRetrying},c={status:b,lastStatus:j,details:a};g.log.info("Status emit",c),d.$emit("status",c),b.isOpen&&!j.isOpen?(d.$emit("opened",c),!b.isRetrying&&j.isRetrying&&d.$emit("reconnected",c)):!b.isOpen&&j.isOpen&&d.$emit("closed",c),b.isRetrying&&!j.isRetrying&&d.$emit("retrying",c),j=b};return g.onopen=function(b,c){g.log.info("Connection opened",{session:b,details:c}),k(c);for(var d,e=g._vueWampQRes.length;0<g._vueWampQRes.length;)d=g._vueWampQRes.shift(),d(b);g.log.info("Sessions resolved:",e),g._vueWampQRej=[],a.hasOwnProperty("onopen")&&"function"==typeof a.onopen&&a.onopen(b,c)},g.onclose=function(b,c){g.log.info("Connection closed",{reason:b,details:c});var d=!1;c.will_retry||(g._autoreconnect_reset(),d=!0),k(c);for(var e,f=g._vueWampQRej.length;0<g._vueWampQRej.length;)e=g._vueWampQRej.shift(),e({reason:b,details:c});return g.log.info("Sessions rejected:",f),g._vueWampQRes=[],a.hasOwnProperty("onclose")&&"function"==typeof a.onclose&&a.onclose(b,c),d},g.log.info("Connection create",{Connection:h(g)}),k(null),g}return e(c,a),d(c,[{key:"withContext",value:function(a){return new r(this,a,this._vueWampEvents)}},{key:"open",value:function(){this.isConnected||this.isOpen||(this.log.info("Connection open",{Connection:this}),k(f(c.prototype),"open",this).call(this))}},{key:"close",value:function(a,b){(this.isConnected||this.isOpen||this.isRetrying)&&(this.log.info("Connection close",{Connection:this,reason:a,message:b}),k(f(c.prototype),"close",this).call(this,a,b))}},{key:"reconnect",value:function(){this.close("wamp.goodbye.reconnect"),this.open()}},{key:"call",value:function(a,b,c,e){b=b||[],c=c||{},e=e||{},this.log.info("CALL",{procedure:a,args:b,kwargs:c,options:e});var f=this.defer();return this.sessionPromise.then(function(d){return d.call(a,b,c,e).then(f.resolve,f.reject,f.notify)}).catch(f.reject),f.promise}},{key:"publish",value:function(a,b,c,e){b=b||[],c=c||{},e=e||{},e.acknowledge=!0,this.log.info("PUBLISH",{topic:a,args:b,kwargs:c,options:e});var f=this.defer();return this.sessionPromise.then(function(d){return d.publish(a,b,c,e).then(f.resolve,f.reject)}).catch(f.reject),f.promise}},{key:"register",value:function(a,b,c){c=c||{},c.acknowledge=!0,this.log.info("REGISTER",{procedure:a,endpoint:b,options:c});var e=this.defer();return this.sessionPromise.then(function(d){return d.register(a,b,c).then(e.resolve,e.reject)}).catch(e.reject),e.promise}},{key:"subscribe",value:function(a,b,c){c=c||{},this.log.info("SUBSCRIBE",{topic:a,handler:b,options:c});var e=this.defer();return this.sessionPromise.then(function(d){return d.subscribe(a,b,c).then(e.resolve,e.reject)}).catch(e.reject),e.promise}},{key:"unregister",value:function(a){this.log.info("UNREGISTER",a);var b=this.defer();return this.sessionPromise.then(function(c){return c.unregister(a).then(b.resolve,b.reject)}).catch(b.reject),b.promise}},{key:"unsubscribe",value:function(a){this.log.info("UNSUBSCRIBE",a);var b=this.defer();return this.sessionPromise.then(function(c){return c.unsubscribe(a).then(b.resolve,b.reject)}).catch(b.reject),b.promise}},{key:"log",get:function(){return this._vueWampCfg.debug?u:t}},{key:"sessionPromise",get:function(){var a=this.defer();return this.isOpen&&this.session?a.resolve(this.session):(this.open(),this._vueWampQRes.push(a.resolve),this._vueWampQRej.push(a.reject)),a.promise}}]),c}(a.Connection);return function(a,b){var c=new a,d=new w(b,c);a.Wamp=d,Object.defineProperties(a.prototype,{$wamp:{get:function(){return this._vueWampWithContext||(this._vueWampWithContext=d.withContext(this)),this._vueWampWithContext}}}),a.mixin({data:function(){return{wampIsConnected:!1,wampIsOpen:!1,wampIsRetrying:!1}},created:function(){var a=this;if(this===this.$root&&(c.$on("status",function(b){a.wampIsConnected=b.status.isConnected,a.wampIsOpen=b.status.isOpen,a.wampIsRetrying=b.status.isRetrying,a.$emit("$wamp.status",b)}),c.$on("opened",function(b){return a.$emit("$wamp.opened",b)}),c.$on("closed",function(b){return a.$emit("$wamp.closed",b)}),c.$on("retrying",function(b){return a.$emit("$wamp.retrying",b)}),c.$on("reconnected",function(b){return a.$emit("$wamp.reconnected",b)})),!!this.$options.wamp){var b=["subscribe","register"],e=this.$options.wamp,f=function(c){c=b[c];var f=e[c],h=function(b){if(!f.hasOwnProperty(b))return"continue";var e=f[b],g=void 0,h={acknowledge:!0};if("function"==typeof e?g=e:(g=e.handler,h=Object.assign(h,e),delete h.handler),"function"!=typeof e)throw"vue-wamp handler must be callable";a.$wamp[c](b,g.bind(a),h).then(function(a){return d.log.info("Component option: "+c+" "+b,a)}).catch(d.log.error)};for(var i in f){var j=h(i)}g=c};for(var g in b)f(g)}},beforeDestroy:function(){this.$wamp.destroy()}})}});
//# sourceMappingURL=vue-wamp.js.map
